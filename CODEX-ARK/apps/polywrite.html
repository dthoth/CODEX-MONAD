<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PolyWrite | CODEX-ARK</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --bg: #0a0a0f;
            --surface: #111118;
            --border: #252530;
            --text: #d0d0d0;
            --dim: #707080;
            --accent: #ff6611;
        }
        body {
            font-family: ui-monospace, Consolas, 'Courier New', monospace;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .title {
            font-size: 1rem;
            color: var(--accent);
            text-decoration: none;
        }
        .title:hover { text-decoration: underline; }
        .controls {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        button {
            font-family: inherit;
            font-size: 0.8rem;
            padding: 0.4rem 0.75rem;
            background: var(--surface);
            color: var(--text);
            border: 1px solid var(--border);
            cursor: pointer;
        }
        button:hover { border-color: var(--accent); }
        button:active { background: var(--border); }
        .stats {
            font-size: 0.75rem;
            color: var(--dim);
            padding: 0.5rem 1rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
        }
        .stats span { white-space: nowrap; }
        .editor-wrap {
            flex: 1;
            display: flex;
            padding: 1rem;
            min-height: 0;
        }
        #editor {
            flex: 1;
            background: var(--surface);
            color: var(--text);
            border: 1px solid var(--border);
            padding: 1rem;
            font-family: inherit;
            font-size: 1rem;
            line-height: 1.6;
            resize: none;
            outline: none;
        }
        #editor:focus { border-color: var(--accent); }
        .status {
            font-size: 0.7rem;
            color: var(--dim);
            padding: 0.5rem 1rem;
            border-top: 1px solid var(--border);
            text-align: right;
        }
        .saved { color: var(--accent); }
        @media (max-width: 500px) {
            header { justify-content: center; text-align: center; }
            .controls { justify-content: center; }
        }
    </style>
</head>
<body>

<header>
    <a href="../index.html" class="title">â—‚ PolyWrite</a>
    <div class="controls">
        <button onclick="newDoc()">New</button>
        <button onclick="saveDoc()">Save</button>
        <button onclick="loadDoc()">Load</button>
        <button onclick="exportDoc()">Export .txt</button>
    </div>
</header>

<div class="stats">
    <span>Words: <strong id="wordCount">0</strong></span>
    <span>Characters: <strong id="charCount">0</strong></span>
    <span>Lines: <strong id="lineCount">0</strong></span>
    <span>Paragraphs: <strong id="paraCount">0</strong></span>
</div>

<div class="editor-wrap">
    <textarea id="editor" placeholder="Start writing..." autofocus></textarea>
</div>

<div class="status">
    <span id="statusMsg">Ready</span>
</div>

<script>
(function() {
    var editor = document.getElementById('editor');
    var wordCount = document.getElementById('wordCount');
    var charCount = document.getElementById('charCount');
    var lineCount = document.getElementById('lineCount');
    var paraCount = document.getElementById('paraCount');
    var statusMsg = document.getElementById('statusMsg');
    var STORAGE_KEY = 'polywrite_doc';
    var autoSaveTimer = null;

    function updateStats() {
        var text = editor.value;
        var chars = text.length;
        var words = text.trim() ? text.trim().split(/\s+/).length : 0;
        var lines = text ? text.split(/\n/).length : 0;
        var paras = text.trim() ? text.trim().split(/\n\s*\n/).filter(function(p) { return p.trim(); }).length : 0;

        charCount.textContent = chars;
        wordCount.textContent = words;
        lineCount.textContent = lines;
        paraCount.textContent = paras || (text.trim() ? 1 : 0);
    }

    function showStatus(msg, isSaved) {
        statusMsg.textContent = msg;
        statusMsg.className = isSaved ? 'saved' : '';
    }

    function autoSave() {
        if (autoSaveTimer) clearTimeout(autoSaveTimer);
        autoSaveTimer = setTimeout(function() {
            try {
                localStorage.setItem(STORAGE_KEY, editor.value);
                showStatus('Auto-saved', true);
            } catch(e) {
                showStatus('Auto-save failed', false);
            }
        }, 1000);
    }

    window.newDoc = function() {
        if (editor.value && !confirm('Clear current document?')) return;
        editor.value = '';
        updateStats();
        showStatus('New document', false);
    };

    window.saveDoc = function() {
        try {
            localStorage.setItem(STORAGE_KEY, editor.value);
            showStatus('Saved to browser storage', true);
        } catch(e) {
            showStatus('Save failed: ' + e.message, false);
        }
    };

    window.loadDoc = function() {
        try {
            var saved = localStorage.getItem(STORAGE_KEY);
            if (saved !== null) {
                if (!editor.value || confirm('Load saved document? Current text will be replaced.')) {
                    editor.value = saved;
                    updateStats();
                    showStatus('Loaded from browser storage', true);
                }
            } else {
                showStatus('No saved document found', false);
            }
        } catch(e) {
            showStatus('Load failed: ' + e.message, false);
        }
    };

    window.exportDoc = function() {
        var text = editor.value;
        var blob = new Blob([text], { type: 'text/plain' });
        var url = URL.createObjectURL(blob);
        var a = document.createElement('a');
        var filename = 'polywrite_' + new Date().toISOString().slice(0,10) + '.txt';
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showStatus('Exported: ' + filename, true);
    };

    editor.addEventListener('input', function() {
        updateStats();
        autoSave();
    });

    // Load on start if exists
    try {
        var saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
            editor.value = saved;
            showStatus('Loaded previous session', true);
        }
    } catch(e) {}

    updateStats();
})();
</script>

</body>
</html>

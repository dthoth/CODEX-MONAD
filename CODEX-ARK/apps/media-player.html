<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Player | CODEX-ARK</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --bg: #0a0a0f;
            --surface: #111118;
            --border: #252530;
            --text: #d0d0d0;
            --dim: #707080;
            --accent: #ff6611;
        }
        body {
            font-family: ui-monospace, Consolas, 'Courier New', monospace;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
        }
        .title {
            font-size: 1rem;
            color: var(--accent);
            text-decoration: none;
        }
        .title:hover { text-decoration: underline; }
        .main {
            flex: 1;
            display: flex;
            min-height: 0;
        }
        .viewer {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 1rem;
            min-width: 0;
        }
        .dropzone {
            flex: 1;
            border: 2px dashed var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 1rem;
            min-height: 200px;
            position: relative;
            background: var(--surface);
        }
        .dropzone.dragover { border-color: var(--accent); }
        .dropzone-text {
            color: var(--dim);
            font-size: 0.9rem;
            text-align: center;
            padding: 1rem;
        }
        .dropzone input[type="file"] {
            position: absolute;
            inset: 0;
            opacity: 0;
            cursor: pointer;
        }
        .media-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
            min-height: 200px;
        }
        video, audio {
            max-width: 100%;
            max-height: 100%;
        }
        audio { width: 100%; }
        .media-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        .media-container iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
        }
        .controls {
            padding: 0.75rem;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            align-items: center;
        }
        button {
            font-family: inherit;
            font-size: 0.8rem;
            padding: 0.4rem 0.75rem;
            background: var(--surface);
            color: var(--text);
            border: 1px solid var(--border);
            cursor: pointer;
        }
        button:hover { border-color: var(--accent); }
        button:disabled { opacity: 0.5; cursor: default; }
        .now-playing {
            flex: 1;
            font-size: 0.8rem;
            color: var(--dim);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .sidebar {
            width: 250px;
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            background: var(--surface);
        }
        .sidebar-header {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border);
            font-size: 0.8rem;
            color: var(--accent);
            display: flex;
            justify-content: space-between;
        }
        .playlist {
            flex: 1;
            overflow-y: auto;
            list-style: none;
        }
        .playlist li {
            padding: 0.6rem 0.75rem;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        .playlist li:hover { background: var(--border); }
        .playlist li.active { color: var(--accent); }
        .playlist .type {
            font-size: 0.65rem;
            padding: 0.15rem 0.3rem;
            background: var(--border);
            border-radius: 2px;
            flex-shrink: 0;
        }
        .playlist .name {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .playlist .remove {
            margin-left: auto;
            opacity: 0.5;
            cursor: pointer;
            flex-shrink: 0;
        }
        .playlist .remove:hover { opacity: 1; color: var(--accent); }
        @media (max-width: 700px) {
            .main { flex-direction: column; }
            .sidebar { width: 100%; max-height: 200px; border-left: none; border-top: 1px solid var(--border); }
        }
    </style>
</head>
<body>

<header>
    <a href="../index.html" class="title">◂ Media Player</a>
</header>

<div class="main">
    <div class="viewer">
        <div class="dropzone" id="dropzone">
            <input type="file" id="fileInput" multiple accept="audio/*,video/*,image/*,.pdf,.txt,.md">
            <div class="dropzone-text">
                Drop files here or click to browse<br>
                <small>Audio, Video, Images, PDF, Text</small>
            </div>
        </div>
        <div class="media-container" id="mediaContainer" style="display:none;"></div>
        <div class="controls">
            <button id="btnPrev" disabled>◂◂ Prev</button>
            <button id="btnPlay" disabled>▶ Play</button>
            <button id="btnNext" disabled>Next ▸▸</button>
            <span class="now-playing" id="nowPlaying">No file loaded</span>
        </div>
    </div>
    <aside class="sidebar">
        <div class="sidebar-header">
            <span>Playlist (<span id="playlistCount">0</span>)</span>
            <span style="cursor:pointer;opacity:0.7" onclick="clearPlaylist()">Clear</span>
        </div>
        <ul class="playlist" id="playlist"></ul>
    </aside>
</div>

<script>
(function() {
    var dropzone = document.getElementById('dropzone');
    var fileInput = document.getElementById('fileInput');
    var mediaContainer = document.getElementById('mediaContainer');
    var playlistEl = document.getElementById('playlist');
    var playlistCount = document.getElementById('playlistCount');
    var nowPlaying = document.getElementById('nowPlaying');
    var btnPlay = document.getElementById('btnPlay');
    var btnPrev = document.getElementById('btnPrev');
    var btnNext = document.getElementById('btnNext');

    var playlist = [];
    var currentIndex = -1;
    var currentMedia = null;

    function getFileType(file) {
        var type = file.type || '';
        var name = file.name.toLowerCase();
        if (type.startsWith('video/')) return 'video';
        if (type.startsWith('audio/')) return 'audio';
        if (type.startsWith('image/')) return 'image';
        if (type === 'application/pdf' || name.endsWith('.pdf')) return 'pdf';
        if (type.startsWith('text/') || name.endsWith('.txt') || name.endsWith('.md')) return 'text';
        return 'unknown';
    }

    function addFiles(files) {
        for (var i = 0; i < files.length; i++) {
            var file = files[i];
            var type = getFileType(file);
            if (type !== 'unknown') {
                playlist.push({ file: file, type: type, name: file.name });
            }
        }
        renderPlaylist();
        if (currentIndex === -1 && playlist.length > 0) {
            loadItem(0);
        }
    }

    function renderPlaylist() {
        playlistEl.innerHTML = '';
        playlistCount.textContent = playlist.length;
        playlist.forEach(function(item, i) {
            var li = document.createElement('li');
            li.className = i === currentIndex ? 'active' : '';
            li.innerHTML = '<span class="type">' + item.type.toUpperCase() + '</span>' +
                           '<span class="name">' + escapeHtml(item.name) + '</span>' +
                           '<span class="remove" data-index="' + i + '">✕</span>';
            li.onclick = function(e) {
                if (e.target.classList.contains('remove')) {
                    removeItem(parseInt(e.target.dataset.index));
                } else {
                    loadItem(i);
                }
            };
            playlistEl.appendChild(li);
        });
        updateControls();
    }

    function escapeHtml(str) {
        return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }

    function removeItem(index) {
        playlist.splice(index, 1);
        if (currentIndex === index) {
            if (playlist.length === 0) {
                currentIndex = -1;
                showDropzone();
            } else {
                currentIndex = Math.min(index, playlist.length - 1);
                loadItem(currentIndex);
            }
        } else if (currentIndex > index) {
            currentIndex--;
        }
        renderPlaylist();
    }

    window.clearPlaylist = function() {
        playlist = [];
        currentIndex = -1;
        showDropzone();
        renderPlaylist();
    };

    function showDropzone() {
        dropzone.style.display = 'flex';
        mediaContainer.style.display = 'none';
        mediaContainer.innerHTML = '';
        nowPlaying.textContent = 'No file loaded';
        currentMedia = null;
    }

    function loadItem(index) {
        if (index < 0 || index >= playlist.length) return;
        currentIndex = index;
        var item = playlist[index];

        dropzone.style.display = 'none';
        mediaContainer.style.display = 'flex';
        mediaContainer.innerHTML = '';
        currentMedia = null;

        var url = URL.createObjectURL(item.file);
        nowPlaying.textContent = item.name;

        if (item.type === 'video') {
            var video = document.createElement('video');
            video.src = url;
            video.controls = true;
            video.autoplay = true;
            video.onended = function() { playNext(); };
            mediaContainer.appendChild(video);
            currentMedia = video;
        } else if (item.type === 'audio') {
            var audio = document.createElement('audio');
            audio.src = url;
            audio.controls = true;
            audio.autoplay = true;
            audio.onended = function() { playNext(); };
            mediaContainer.appendChild(audio);
            currentMedia = audio;
        } else if (item.type === 'image') {
            var img = document.createElement('img');
            img.src = url;
            img.alt = item.name;
            mediaContainer.appendChild(img);
        } else if (item.type === 'pdf') {
            var iframe = document.createElement('iframe');
            iframe.src = url;
            mediaContainer.appendChild(iframe);
        } else if (item.type === 'text') {
            var reader = new FileReader();
            reader.onload = function(e) {
                var pre = document.createElement('pre');
                pre.style.cssText = 'color:#d0d0d0;padding:1rem;overflow:auto;width:100%;height:100%;margin:0;white-space:pre-wrap;word-wrap:break-word;';
                pre.textContent = e.target.result;
                mediaContainer.appendChild(pre);
            };
            reader.readAsText(item.file);
        }

        renderPlaylist();
    }

    function playNext() {
        if (currentIndex < playlist.length - 1) {
            loadItem(currentIndex + 1);
        }
    }

    function playPrev() {
        if (currentIndex > 0) {
            loadItem(currentIndex - 1);
        }
    }

    function togglePlay() {
        if (!currentMedia) return;
        if (currentMedia.paused) {
            currentMedia.play();
        } else {
            currentMedia.pause();
        }
        updatePlayButton();
    }

    function updatePlayButton() {
        if (currentMedia) {
            btnPlay.textContent = currentMedia.paused ? '▶ Play' : '❚❚ Pause';
        } else {
            btnPlay.textContent = '▶ Play';
        }
    }

    function updateControls() {
        btnPrev.disabled = currentIndex <= 0;
        btnNext.disabled = currentIndex >= playlist.length - 1 || playlist.length === 0;
        btnPlay.disabled = !currentMedia;
        updatePlayButton();
    }

    // Event listeners
    dropzone.addEventListener('dragover', function(e) {
        e.preventDefault();
        dropzone.classList.add('dragover');
    });
    dropzone.addEventListener('dragleave', function() {
        dropzone.classList.remove('dragover');
    });
    dropzone.addEventListener('drop', function(e) {
        e.preventDefault();
        dropzone.classList.remove('dragover');
        addFiles(e.dataTransfer.files);
    });
    fileInput.addEventListener('change', function() {
        addFiles(fileInput.files);
        fileInput.value = '';
    });

    btnPlay.onclick = togglePlay;
    btnNext.onclick = playNext;
    btnPrev.onclick = playPrev;

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        if (e.target.tagName === 'INPUT') return;
        if (e.code === 'Space') { e.preventDefault(); togglePlay(); }
        if (e.code === 'ArrowRight') { playNext(); }
        if (e.code === 'ArrowLeft') { playPrev(); }
    });

    updateControls();
})();
</script>

</body>
</html>
